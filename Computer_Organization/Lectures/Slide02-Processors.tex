\documentclass[UTF8]{ctexbeamer}
\usepackage{latexsym}
\usepackage{amsmath,amssymb}
\usepackage{color,xcolor}
\usepackage{graphicx}
\usepackage{algorithm}
\usepackage{amsthm}
\usepackage{multicol,multirow}
\usepackage{tikz-cd}

\newcommand{\fontsm}{\fontsize{8}{9.2}\selectfont}

\usetheme{AnnArbor}
\usefonttheme[onlymath]{serif}
\usecolortheme{crane}

\title{Computer System Architecture}
\subtitle{--- Computation, ISA and Datapath}

\author[chhzh123]{é™ˆé¸¿å³¥}
\date[Dec 30, 2018]{December, 2018}

\keywords{}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\begin{frame}
\tableofcontents[hideallsubsections]
\end{frame}

\section{èƒŒæ™¯ã€å†å²ã€é¢„å¤‡çŸ¥è¯†}
\begin{frame}
\sectionpage
\end{frame}

\subsection{ä»ä¸€åˆ‡çš„æºå¤´è®²èµ·---è®¡ç®—æ¨¡å‹}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}{ä¸€åˆ‡çš„å¼€ç«¯}
\begin{center}
\large\textbf{æˆ‘ä»¬å¿…é¡»çŸ¥é“ï¼Œæˆ‘ä»¬å¿…å°†çŸ¥é“ã€‚}\\
\textbf{Wir m\"ussen wissen, wir werden wissen.}\\
\qquad\qquad\qquad\qquad\qquad\textbf{---å¤§å« å¸Œå°”ä¼¯ç‰¹(David Hilbert),1930}
\end{center}
\pause
å¸Œå°”ä¼¯ç‰¹23ä¸ªé—®é¢˜ï¼šç¬¬äºŒä¸ªé—®é¢˜ --- ç®—æœ¯ç³»ç»Ÿçš„ç›¸å®¹æ€§
\begin{enumerate}
	\item æ•°å­¦æ˜¯å®Œå¤‡çš„å—(complete)ï¼Ÿ% é¢å¯¹é‚£äº›æ­£ç¡®çš„æ•°å­¦é™ˆè¿°ï¼Œæˆ‘ä»¬æ˜¯å¦æ€»èƒ½æ‰¾å‡ºä¸€ä¸ªè¯æ˜
	\item æ•°å­¦æ˜¯ä¸€è‡´çš„å—(consistent)ï¼Ÿ% æ•°å­¦æ˜¯å¦æ²¡æœ‰å†…éƒ¨çŸ›ç›¾
	\item æ•°å­¦æ˜¯å¯åˆ¤å®šçš„å—(decidable)ï¼Ÿ% ä»…ä»…é€šè¿‡æœºæ¢°åŒ–çš„è®¡ç®—ï¼Œå°±èƒ½åˆ¤å®šæŸä¸ªæ•°å­¦é™ˆè¿°æ˜¯å¯¹æ˜¯é”™
\end{enumerate}
\pause
\begin{itemize}[<+->]
	\item å“¥å¾·å°”(G\"odel)ä¸å®Œå¤‡æ€§å®šç†, 1931
	\begin{itemize}
		\item \textbf{å½¢å¼åŒ–}æ­¦å™¨
		% å“¥å¾·å°”çš„è¯æ˜éå¸¸çš„é•¿ï¼Œè¾¾åˆ°äº†200å¤šé¡µçº¸ï¼Œä½†å…¶ä¸­å¾ˆå¤§çš„æˆåˆ†æ˜¯ç”¨åœ¨äº†ä¸€äº›è¾…åŠ©æ€§çš„å·¥ä½œä¸Šé¢ï¼Œæ¯”å¦‚å æ®è¶…è¿‡1/3çº¸å¼ çš„æ˜¯å…³äºä¸€ä¸ªå½¢å¼ç³»ç»Ÿå¦‚ä½•æ˜ å°„åˆ°è‡ªç„¶æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚ä½•æŠŠä¸€ä¸ªå½¢å¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰å…¬å¼éƒ½è¡¨ç¤ºä¸ºè‡ªç„¶æ•°ï¼Œå¹¶å¯ä»¥ä»ä¸€è‡ªç„¶æ•°åè¿‡æ¥å¾—å‡ºç›¸åº”çš„å…¬å¼ã€‚è¿™å…¶å®å°±æ˜¯ç¼–ç ï¼Œåœ¨æˆ‘ä»¬ç°åœ¨çœ‹æ¥æ˜¯å¾ˆæ˜¾ç„¶çš„ï¼Œå› ä¸ºä¸€ä¸ªç¨‹åºå°±å¯ä»¥è¢«ç¼–ç æˆäºŒè¿›åˆ¶æ•°ï¼Œåè¿‡æ¥ä¹Ÿå¯ä»¥è§£ç ã€‚ä½†æ˜¯åœ¨å½“æ—¶è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ€æƒ³ï¼Œä¹Ÿæ˜¯æœ€å…³é”®çš„è¾…åŠ©æ€§å·¥ä½œä¹‹ä¸€ï¼Œå¦ä¸€æ–¹é¢ï¼Œè¿™æ­£æ˜¯â€œç¨‹åºå³æ•°æ®â€çš„æœ€åˆæƒ³æ³•ã€‚
		% https://www.jianshu.com/p/9236794ddef3
		% \item é€’å½’å‡½æ•° % ($\mu$-recursive function)
		\item \textbf{ä¸€é˜¶è°“è¯é€»è¾‘}æ˜¯å®Œå¤‡çš„
	\end{itemize}
% ä»»ä½•åŒ…å«äº†ç®—æœ¯çš„æ•°å­¦ç³»ç»Ÿéƒ½ä¸å¯èƒ½åŒæ—¶æ‹¥æœ‰å®Œå¤‡æ€§å’Œä¸€è‡´æ€§
% ä»»ä½•åŒ…å«äº†ç®—æœ¯çš„æ•°å­¦ç³»ç»Ÿï¼Œå¦‚æœå®ƒæ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸èƒ½åœ¨å®ƒçš„å†…éƒ¨è¯æ˜å®ƒæœ¬èº«çš„ä¸€è‡´æ€§
% -> åœ¨æ•°å­¦çš„é¢†åœ°ä¸Šï¼Œæœ‰äº›ä¸œè¥¿æˆ‘ä»¬ä¸çŸ¥é“ï¼Œä¹Ÿä¸å¯èƒ½çŸ¥é“ã€‚
%% å“¥å¾·å°”ä¸å®Œå¤‡æ€§å®šç†å‘Šè¯‰æˆ‘ä»¬ï¼Œæœ‰æ—¶å€™è¶Šå¼ºå¤§çš„æ•°å­¦ç†è®ºï¼Œå› ä¸ºèƒ½è¡¨è¾¾çš„æ¦‚å¿µå¤ªå¤šï¼Œç”šè‡³è¿ç†è®ºçš„å‘½é¢˜å’Œè¯æ˜éƒ½èƒ½è¡¨è¾¾ï¼Œåè€Œä¼šå¯¼è‡´ä¸èƒ½è¢«è¯æ˜çš„çœŸå‘½é¢˜çš„å­˜åœ¨
	% \item å›¾çµ(Turing)æœº, 1936
\end{itemize}
\end{frame}
% http://songshuhui.net/archives/70194
% http://songshuhui.net/archives/20161

\begin{frame}
\only<1->{
\begin{center}
\Large\textbf{ä»€ä¹ˆæ˜¯è®¡ç®—ï¼Ÿ}
\end{center}
}
\only<2>{
\begin{figure}
\centering
\includegraphics[width=0.6\linewidth]{fig/Lecture2/Abstraction-Computation.pdf}
\end{figure}
}
\end{frame}

% è€Œè®¡ç®—åˆšå¥½è§£å†³äº†è¿™ä¸ªé—®é¢˜â€”â€”è®¡ç®—å®šä¹‰äº†æœºæ¢°å¯ä»¥åšä»€ä¹ˆï¼Œä¸å¯ä»¥åšä»€ä¹ˆã€‚å¦‚æœå®‡å®™/æ€æƒ³/å¤§è„‘/å°å…”å­/ä¸Šå¸æ˜¯å¯ä»¥ç”¨æœºæ¢°çš„æ–¹æ³•è§£é‡Šçš„ï¼Œé‚£ä¹ˆä»–ä»¬å°±æ˜¯ç”µè„‘ï¼Œåä¹‹äº¦ç„¶ã€‚
\begin{frame}{å›¾çµæœº}
Alan Turing, \emph{On Computable Numbers, With an Application to the Entscheidungsproblem}, 1936
\only<1>{
\begin{figure}
\centering
\includegraphics[width=0.25\linewidth]{fig/Lecture2/turing_machine.jpg}
\end{figure}
\begin{columns}
\begin{column}{0.5\linewidth}
\begin{itemize}
	\item çº¸å¸¦(tape)
	\item è¯»å†™å¤´(head)
	\item çŠ¶æ€å¯„å­˜å™¨(state register)
	\item æœ‰é™çŠ¶æ€è¡¨(table)
\end{itemize}
\end{column}
\begin{column}{0.5\linewidth}
åŸºæœ¬æ“ä½œï¼š
\begin{itemize}
	\item è¯»ç¬¦å·
	\item ä¸ä¿®æ”¹æˆ–è€…å†™ç¬¦å·
	\item å·¦ç§»æˆ–å³ç§»çº¸å¸¦
\end{itemize}
\end{column}
\end{columns}
}
\only<2>{
\begin{figure}
\centering
\includegraphics[width=0.25\linewidth]{fig/Lecture2/turing_machine.jpg}
\end{figure}
åœæœºé—®é¢˜ï¼šæ˜¯å¦å­˜åœ¨è¿™æ ·çš„å›¾çµæœºèƒ½å¤Ÿåˆ¤æ–­ä¸€ä¸ªç¨‹åºåœ¨ç»™å®šè¾“å…¥ä¸Šæ˜¯å¦ä¼šåœæœº/ç»“æŸï¼Ÿ
% â€œä¸€é˜¶è°“è¯æ¼”ç®—â€æ˜¯å®Œå¤‡çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ä¸ªæ•°å­¦ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªçœŸç†éƒ½èƒ½è¢«è¯æ˜ï¼Œâ€œçœŸâ€å’Œâ€œèƒ½è¢«è¯æ˜â€è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯ä¸€è‡´çš„
% å¸Œå°”ä¼¯ç‰¹çš„å¯åˆ¤å®šæ€§é—®é¢˜æ˜¯ï¼šæ˜¯å¦å­˜åœ¨ä¸€ç§è®¡ç®—è¿‡ç¨‹ï¼Œå¯ä»¥åœ¨æœ‰é™æ­¥è¿ç®—å†…ï¼Œåˆ¤æ–­åœ¨è¿™ä¸ªå®Œå¤‡çš„æ•°å­¦ç³»ç»Ÿä¸­æ¯ä¸ªå‘½é¢˜çš„çœŸå‡ï¼Ÿ
}
\only<3->{
\\åœæœºé—®é¢˜ï¼šæ˜¯å¦å­˜åœ¨è¿™æ ·çš„å›¾çµæœºèƒ½å¤Ÿåˆ¤æ–­ä¸€ä¸ªç¨‹åºåœ¨ç»™å®šè¾“å…¥ä¸Šæ˜¯å¦ä¼šåœæœº/ç»“æŸï¼Ÿ
\begin{figure}
\centering
\includegraphics[width=0.5\linewidth]{fig/Lecture2/halting_problem.png}
\end{figure}
}
\only<4>{
\begin{center}
\large å³ä½¿æ˜¯å®Œå¤‡çš„æ•°å­¦ç³»ç»Ÿï¼Œä¹Ÿæ˜¯\textbf{ä¸å¯åˆ¤å®š}çš„ï¼
\end{center}
}
\end{frame}
% èµ‹å€¼ã€è·³è½¬ã€æ¯”è¾ƒ å›¾çµæœºä¸ç¼–ç¨‹è¯­è¨€ - ç‹å…ˆç”Ÿçš„æ–‡ç«  - çŸ¥ä¹ https://zhuanlan.zhihu.com/p/26328692

\begin{frame}{$\lambda$-Calculus}
Alonzo Church, \emph{An unsolvable problem of elementary number theory}, 1936
\only<1>{
\begin{itemize}
	\item å˜é‡(variable)ï¼š$x$
	\item æŠ½è±¡(abstraction)ï¼š$(\lambda x.M)$
	\item åº”ç”¨(application)ï¼š$(M N)$
\end{itemize}
Operation:
\begin{itemize}
	\item $\alpha$è½¬æ¢(conversion)ï¼š$(\lambda x.M[x]) \to (\lambda y.M[y])$
	\item $\beta$è§„çº¦(reduction)ï¼š$((\lambda x.M) E \to (M[x\gets E]))$
\end{itemize}
}
\only<1-2>{
\begin{figure}
\centering
\begin{tabular}{cc}
\includegraphics[width=0.5\linewidth]{fig/Lecture2/lambda_formula.jpg}&
\includegraphics[width=0.4\linewidth]{fig/Lecture2/lambda_formula_2.jpg}
\end{tabular}
\end{figure}
}
\only<2>{
\begin{center}
æ²¡æœ‰\textbf{æ•°æ®å’Œç¨‹åº}ä¹‹åˆ†ï¼\\
ä¸€åˆ‡éƒ½æ˜¯$\lambda$é¡¹ï¼Œå®ƒä»¬æ—¢æ˜¯ç¨‹åºï¼Œä¹Ÿæ˜¯æ•°æ®
\end{center}
}
\end{frame}
% æˆ‘ä»¬ç”šè‡³å¯ä»¥è¯´ï¼Œå›¾çµæœºçš„è®¾è®¡æœ¬èº«ï¼Œæ­£æ˜¯è¿™äº›é™åˆ¶çš„ä¸€ç§ä½“ç°ã€‚å›¾çµå¾ˆå¯èƒ½ä¸€å¼€å§‹å°±æ„è¯†åˆ°äº†è¿™äº›é™åˆ¶ï¼Œå†ç”±æ­¤å‡ºå‘ï¼Œå»å®šä¹‰ä»–çš„å›¾çµæœºã€‚å“¥å¾·å°”ä¹‹æ‰€ä»¥å¯¹å›¾çµæœºå‡»èŠ‚å¹èµï¼Œå¤§æ¦‚ä¹Ÿæ­£å› è•´å«åœ¨å®ƒå®šä¹‰ä¸­çš„ï¼Œå›¾çµå¯¹â€œæœºæ¢°è®¡ç®—â€çš„æ·±åˆ»æ´å¯Ÿã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œè™½ç„¶ä¸ä¹‹ç­‰ä»·çš„Î»æ¼”ç®—ä¹Ÿå°šç®—ç²¾è‡´ï¼Œä½†å¯¹äºâ€œæœºæ¢°è®¡ç®—â€åªå¾—å…¶å½¢æœªå¾—å…¶ç¥ï¼Œæ˜¾ç„¶é€Šè‰²ä¸å°‘ã€‚
% Deutsch æ‰€æœ‰ï¼ˆæœ‰é™çš„å¯ä»¥å®ç°çš„ï¼‰ç‰©ç†ç³»ç»Ÿéƒ½å¯ä»¥è¢«ä¸€å°é€šç”¨è®¡ç®—æœºå™¨æ¥æ¨¡æ‹Ÿã€‚ é‡å­è®¡ç®—

\begin{frame}{å›¾çµå®Œå¤‡}
\begin{center}
\large\textbf{å›¾çµæœºä¸$\lambda$-æ¼”ç®—ç­‰ä»·ï¼ï¼ˆå›¾çµå®Œå¤‡ï¼‰}
\end{center}
\pause
\begin{center}
\fontsm
\begin{tabular}{|c|c|}\hline
å‘½ä»¤å¼è¯­è¨€(imperative) & å‡½æ•°å¼è¯­è¨€(functional)\\\hline
å›¾çµç³» & ä¸˜å¥‡ç³» \\\hline
é¢å‘è®¡ç®—æœºç¡¬ä»¶çš„æŠ½è±¡ & é¢å‘æ•°å­¦çš„æŠ½è±¡\\\hline
æŒ‡ä»¤åºåˆ— & è¡¨è¾¾å¼ï¼ˆå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼‰\\\hline
C/C++/Python/Java & Lisp/Haskell/ML/Coq\\\hline
é¡ºåºæ‰§è¡Œ & å¯¹æ±‚å€¼é¡ºåºä¸ç›¸å…³ï¼Œæ˜“äºå¹¶è¡Œ\\
æœ‰å‰¯ä½œç”¨ï¼Œä¾èµ–å¤–éƒ¨ç¯å¢ƒï¼ˆå¦‚IOï¼‰ & æ— å‰¯ä½œç”¨ï¼Œçº¯å‡½æ•°ï¼Œä¸å‡ºç°ç«äº‰å†’é™©\\
å˜é‡å¯¹åº”ç€å­˜å‚¨å•å…ƒ & å˜é‡åªæ˜¯ä»£æ•°åç§°\\\hline
\end{tabular}
\end{center}
\pause
è‹¥ä¸è€ƒè™‘å†…å­˜çš„é™åˆ¶ï¼Œç»å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æ˜¯å›¾çµå®Œå¤‡çš„
\end{frame}

\begin{frame}{è®¡ç®—æ¨¡å‹}
\begin{center}
\Large\textbf{ä»€ä¹ˆæ˜¯å¯è®¡ç®—çš„ï¼Ÿ(Computability)}
\end{center}
\pause
\begin{center}
\Large\textbf{Church-Turing Thesis}\\
\largeæ‰€æœ‰å¯ä»¥æœ‰æ•ˆè®¡ç®—çš„å‡½æ•°éƒ½å¯ä»¥è¢«é€šç”¨å›¾çµæœºè®¡ç®—
\end{center}
\begin{itemize}
	\item \textbf{æœºæ¢°è®¡ç®—}å°±æ˜¯å›¾çµæœºèƒ½åšçš„è®¡ç®— $\gets$ å¯è®¡ç®—ç†è®ºçš„åŸºçŸ³ % å¸Œå°”ä¼¯ç‰¹åœ¨ä»–çš„é—®é¢˜ä¸­é‚£æ¨¡ç³Šçš„â€œæœºæ¢°è®¡ç®—â€
	\item \textbf{ç›®å‰}ä»»ä½•è®¡ç®—è£…ç½®ï¼ˆä¹ƒè‡³å¤§è„‘ã€è¶…ç®—ï¼‰éƒ½ä¸èƒ½è¶…è¿‡å›¾çµæœºçš„èƒ½åŠ›ï¼ˆä¸è€ƒè™‘é€Ÿåº¦ï¼Œåªè€ƒè™‘å¯è®¡ç®—æ€§ï¼‰
\end{itemize}
\end{frame}
% ä¸€é˜¶é€»è¾‘ å½¢å¼éªŒè¯
% å¯†ç å­¦
% å‡½æ•°å¼ç¼–ç¨‹
% è®¡ç®—å¤æ‚æ€§ç†è®º

\begin{frame}
\begin{center}
\Large\textbf{æ€ä¹ˆå»è®¡ç®—ï¼Ÿ}
\end{center}
\end{frame}

\begin{frame}
\begin{center}
$\lambda$-æ¼”ç®— æ›´åƒæ˜¯æ™ºæ…§çš„æ¨ç†\\
\quad\\
è€Œ å›¾çµæœº çœŸæ­£æŠ“ä½äº† {\Large\textbf{æœºæ¢°è®¡ç®—}} çš„ç¥éŸµ
\end{center}
\end{frame}

\subsection{å†¯è¯ºä¾æ›¼ä½“ç³»ç»“æ„}
\begin{frame}
\subsectionpage
\end{frame}

% \begin{frame}
% ENIAC, ç¬¬ä¸€å°ç”µå­è®¡ç®—æœº
% åè¿›åˆ¶è®¡ç®—ï¼Œé€»è¾‘å…ƒä»¶å¤šï¼Œç»“æ„å¤æ‚ï¼Œå¯é æ€§ä½
% ä¸æ˜¯å­˜å‚¨ç¨‹åºå¼çš„è®¡ç®—æœºï¼Œç¼–ç¨‹é€šè¿‡æ‰‹å·¥æ’æ¥çº¿æ–¹å¼è¿›è¡Œ
% \end{frame}

\begin{frame}{å†¯è¯ºä¾æ›¼ä½“ç³»ç»“æ„}
\begin{itemize}
	\item å›¾çµæœºæ˜¯\textbf{ç†è®º}çš„æœ€ç®€å•çš„æ¨¡å‹ï¼Œä½†å…·æœ‰éå¸¸å¼ºçš„è®¡ç®—åŠ›
	\item å†¯è¯ºä¾æ›¼(von Neumann)ä½“ç³»ç»“æ„åˆ™æ˜¯å¯¹å›¾çµæœºçš„ç‰©ç†\textbf{å®ç°}(EDVAC, 1945)
\end{itemize}
% EDVAC, 1945, ç¬¬ä¸€å°ç°ä»£æ„ä¹‰çš„é€šç”¨è®¡ç®—æœº, é¦–æ¬¡ç”¨äºŒè¿›åˆ¶
\begin{figure}
\centering
\includegraphics[width=0.5\linewidth]{fig/Lecture2/Von_Neumann_Architecture.png}
\end{figure}
\begin{itemize}[<+->]
	\item \textbf{å­˜å‚¨å™¨ï¼}äºŒè¿›åˆ¶ï¼
	\item æ‰€æœ‰æŒ‡ä»¤ä¸æ•°æ®éƒ½\textbf{æ— åŒºåˆ«}åœ°å­˜å‚¨åœ¨è®¡ç®—æœºä¸­
\end{itemize}
\end{frame}

\subsection{æ•°æ®çš„è¡¨ç¤ºä¸å¤§å°}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}[fragile]{æ•°æ®çš„è¡¨ç¤º}
æ•°æ®çš„è¡¨ç¤º
\begin{itemize}
	\item åŸç (sign-magnitude)ï¼šæœ€é«˜ä½ä¸ºç¬¦å·ä½
	\item åç (\textbf{ones'} complement)ï¼šè´Ÿæ•°æŒ‰ä½å–å
	\item è¡¥ç (\textbf{two's} complement)ï¼šæ¨¡$2^n$è¿ç®—ï¼Œåç +1
\end{itemize}
è¿›åˆ¶
\begin{itemize}
	\item äºŒè¿›åˆ¶\verb'0b10'
	\item å…«è¿›åˆ¶\verb'034'
	\item åå…­è¿›åˆ¶\verb'0xFF'æˆ–\verb'FFH'
\end{itemize}
\end{frame}

\begin{frame}{åŸºæœ¬æ•°æ®å•ä½}
æ•°æ®å•ä½
\begin{itemize}
	\item ä½(bit)ï¼šå¤„ç†ä¿¡æ¯çš„æœ€å°å•ä½
	\item å­—èŠ‚(Byte)ï¼šå­˜å‚¨çš„åŸºæœ¬å•ä½ï¼Œ$1$B$=8$bit
	\item å­—(Word)ï¼šéšæœºå™¨è€Œå˜ï¼Œ32ä½æœº $1$Word$=4$B$=32$bit
	\item å­—é•¿(Word length)ï¼šæ•°æ®é€šè·¯çš„å®½åº¦/å­—çš„é•¿åº¦
\end{itemize}
å†…å­˜å¤§å°\\
\begin{center}
1KiB=$2^{10}$B\qquad
1MiB=$2^{10}$KiB\qquad
1GiB=$2^{10}$MiB
\end{center}
\end{frame}

\section{æŒ‡ä»¤é›†ç³»ç»Ÿæ¦‚è¿°}
\begin{frame}
\sectionpage
\end{frame}

\subsection{æŒ‡ä»¤é›†èƒŒæ™¯}
\begin{frame}[fragile]{æŒ‡ä»¤é›†èƒŒæ™¯}
\only<1>{
\begin{center}
\begin{tikzcd}
\text{Machine Language (Binary)[1945]}
\end{tikzcd}
\end{center}
}
\only<2>{
\begin{center}
\begin{tikzcd}
\text{Assembly Language [1947]}\arrow{d}{Assembler[1948]}\\
\text{Machine Language (Binary)[1945]}
\end{tikzcd}
\end{center}
}
\only<3>{
\begin{center}
\begin{tikzcd}
\text{Natural language}\arrow{d}\\
\text{High-Level Programming Language (FORTRAN)[1954]}\arrow{d}{\text{Compiler}[1954]}\\
\text{Assembly Language [1947]}\arrow{d}{\text{Assembler}[1948]}\\
\text{Machine Language (Binary)[1945]}
\end{tikzcd}
\end{center}
}
\only<4>{
\begin{center}
\begin{tikzcd}
\text{Natural language}\arrow{d}\\
\text{High-Level Programming Language (FORTRAN)[1954]}\arrow{d}{\text{Compiler}[1954]}\\
\text{Assembly Language [1947]}\arrow{d}{\text{Assembler}[1948]}\\
\text{Machine Language (Binary)[1945]}
\end{tikzcd}
\end{center}
}
\only<5>{
\begin{columns}
\begin{column}{0.65\linewidth}
\begin{center}
\begin{tikzcd}
\text{Natural language}\arrow{d}\\
\text{High-Level Programming Language [1954]}\arrow{d}{\text{Compiler}[1954]}\\
\text{Assembly Language [1947]}\arrow{d}{\begin{tabular}{l}\fontsm\text{Assembler[1948]}\\\fontsm\text{\textcolor{red}{Instruction Set Architecture (ISA)[1970s]}}\end{tabular}}\\
\text{Machine Language (Binary)[1945]}
\end{tikzcd}
\end{center}
\end{column}
\begin{column}{0.35\linewidth}
Assembly:\\
add \$1, \$0, 1 \\
sw \$1, \$0(4) \\
\quad\\
Machine:\\
0000 0010 1100 0111 \\
0001 1101 0100 1000
\end{column}
\end{columns}
}
\end{frame}

\subsection{æŒ‡ä»¤ç³»ç»Ÿçš„ä½œç”¨}
\begin{frame}{æŒ‡ä»¤ç³»ç»Ÿæ¦‚è¿°}
\begin{figure}
\centering
\includegraphics[width=0.9\linewidth]{fig/Lecture2/overview.PNG}
\end{figure}
\end{frame}

\begin{frame}{æŒ‡ä»¤ç³»ç»Ÿçš„ä½œç”¨}
\begin{itemize}
	\item ç¡¬ä»¶è®¾è®¡è€…è§’åº¦ï¼š
	\begin{itemize}
		\item ISAä¸ºCPUæä¾›åŠŸèƒ½éœ€æ±‚
		\item ISAè®¾è®¡ç›®æ ‡ï¼šæ˜“äºç¡¬ä»¶é€»è¾‘è®¾è®¡
	\end{itemize}
	\item ç³»ç»Ÿç¨‹åºå‘˜è§’åº¦ï¼š
	\begin{itemize}
		\item é€šè¿‡ISAä½¿ç”¨ç¡¬ä»¶èµ„æº
		\item ISAè®¾è®¡ç›®æ ‡ï¼šæ˜“äºç¼–å†™ç¼–è¯‘å™¨
	\end{itemize}
\end{itemize}
\begin{center}
\textbf{ISA determines the performance and the cost of computers}
\end{center}
\end{frame}

\subsection{æŒ‡ä»¤é›†è®¡ç®—æœº}
\begin{frame}[fragile]{æŒ‡ä»¤é›†è®¡ç®—æœº}
\begin{center}
\begin{tabular}{|p{5cm}|p{5cm}|}
\hline
\multicolumn{1}{|c|}{\textbf{å¤æ‚æŒ‡ä»¤é›†è®¡ç®—æœº}} & \multicolumn{1}{c|}{\textbf{ç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœº}} \\\hline
CISC, Complex Instruction Set Computer & RISC, Reduce Instruction Set Computer\\\hline
å‡ºç°è¾ƒæ—©(1970s)ï¼Œå¤§è€Œå…¨ & å‡ºç°è¾ƒæ™š(1980s)ï¼Œå°è€Œç²¾ \\\hline
æŒ‡ä»¤å‘¨æœŸé•¿ï¼Œä¸“ç”¨å¯„å­˜å™¨ï¼Œå¾®ç¨‹åºæ§åˆ¶ï¼Œéš¾ç¼–è¯‘ä¼˜åŒ–ç”Ÿæˆé«˜æ•ˆç›®æ ‡ä»£ç ï¼Œæ•ˆç‡ä½ & æŒ‡ä»¤å‘¨æœŸçŸ­ï¼Œå¤§é‡é€šç”¨å¯„å­˜å™¨ï¼Œç»„åˆé€»è¾‘ç”µè·¯æ§åˆ¶ï¼Œä¼˜åŒ–ç¼–è¯‘ç³»ç»Ÿ\\\hline
å˜é•¿æŒ‡ä»¤å­— & å®šé•¿æŒ‡ä»¤å­— \\\hline
x86 & ARM(Advanced RISC Machine), MIPS, SPARC \\\hline
\end{tabular}
\end{center}
\end{frame}

\begin{frame}{å¤„ç†å™¨æ€§èƒ½è¯„ä»·}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/processor_performance.PNG}
\end{figure}
\# of instructions, cycles, CPI
\end{frame}

\subsection{æŒ‡ä»¤é›†ç³»ç»ŸåŸºæœ¬å†…å®¹}
\begin{frame}{æŒ‡ä»¤é›†ç³»ç»Ÿ}
\begin{enumerate}
	\item ä»€ä¹ˆæ“ä½œï¼Ÿæ“ä½œç 
	\item æ“ä½œå¯¹è±¡ï¼Ÿæ“ä½œæ•°
	\item å¦‚ä½•æ‰¾åˆ°æ“ä½œå¯¹è±¡ï¼Ÿå¯»å€æ–¹å¼ % 4å­—èŠ‚=32ä½
\end{enumerate}
æŒ‡ä»¤=æ“ä½œç +åœ°å€ç 
\end{frame}

\begin{frame}{æŒ‡ä»¤é›†ç³»ç»Ÿ}
\begin{enumerate}
	\item æ•°æ®ä¼ é€æŒ‡ä»¤ï¼šstoreã€load
	\item ç®—æœ¯è¿ç®—æŒ‡ä»¤ï¼šåŠ å‡ä¹˜é™¤
	\item é€»è¾‘è¿ç®—æŒ‡ä»¤ï¼šä¸æˆ–é
	\item è¾“å‡ºè¾“å‡ºæŒ‡ä»¤ï¼šI/O
	\item ç³»ç»Ÿæ§åˆ¶æŒ‡ä»¤ï¼šå¯åŠ¨IOè®¾å¤‡ã€å­˜å–ç‰¹æ®Šå¯„å­˜å™¨æŒ‡ä»¤
	\item ç¨‹åºæ§åˆ¶æŒ‡ä»¤ï¼šè½¬ç§»ã€è·³è½¬ã€è¿”å›ã€ä¸­æ–­
\end{enumerate}
\end{frame}


\section{RISC-VæŒ‡ä»¤é›†æ€»è§ˆ}
\begin{frame}
\sectionpage
\end{frame}

\begin{frame}{RISC-VæŒ‡ä»¤é›†}
\begin{itemize}
	\item æ‰€æœ‰æŒ‡ä»¤éƒ½æ˜¯32ä½å®½(4å­—èŠ‚)ï¼ŒæŒ‰å­—åœ°å€å¯¹é½
	\item åŸºæœ¬çš„RV32Iå…±47æ¡æŒ‡ä»¤
\end{itemize}
\end{frame}
% P35
% 32 ä½å­—èŠ‚å¯å¯»å€çš„åœ°å€ç©ºé—´
% æ‰€æœ‰æŒ‡ä»¤å‡ä¸º 32 ä½é•¿
% 31 ä¸ªå¯„å­˜å™¨ï¼Œå…¨éƒ¨ 32 ä½å®½ï¼Œå¯„å­˜å™¨ 0 ç¡¬è¿çº¿ä¸ºé›¶
% æ‰€æœ‰æ“ä½œéƒ½åœ¨å¯„å­˜å™¨ä¹‹é—´ï¼ˆæ²¡æœ‰å¯„å­˜å™¨åˆ°å†…å­˜çš„æ“ä½œï¼‰
% åŠ è½½/å­˜å‚¨å­—åŠ ä¸Šæœ‰ç¬¦å·å’Œæ— ç¬¦å·åŠ è½½/å­˜å‚¨å­—èŠ‚å’ŒåŠå­—
% æ‰€æœ‰ç®—æœ¯ï¼Œé€»è¾‘å’Œç§»ä½æŒ‡ä»¤éƒ½æœ‰ç«‹å³æ•°ç‰ˆæœ¬çš„æŒ‡ä»¤
% ç«‹å³æ•°æ€»æ˜¯ç¬¦å·æ‰©å±•
% ä»…æä¾›ä¸€ç§æ•°æ®å¯»å€æ¨¡å¼ï¼ˆå¯„å­˜å™¨+ç«‹å³æ•°ï¼‰å’Œ PC ç›¸å¯¹åˆ†æ”¯
% æ— ä¹˜æ³•æˆ–é™¤æ³•æŒ‡ä»¤(RV32Mæ‰©å±•)
% ä¸€ä¸ªæŒ‡ä»¤ï¼Œç”¨äºå°†å¤§ç«‹å³æ•°åŠ è½½åˆ°å¯„å­˜å™¨çš„é«˜ä½ï¼Œè¿™æ ·åŠ è½½ 32 ä½å¸¸é‡åˆ°å¯„å­˜å™¨åªéœ€è¦ä¸¤æ¡æŒ‡ä»¤
% å¤§é‡å¯ç”¨çš„æŒ‡ä»¤ç ç©ºé—´

\begin{frame}[fragile]{Registers}
\verb'x1-x31', \verb'x0'=0, Program Counter (PC)
\begin{columns}
\begin{column}{0.3\linewidth}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/general_registers.PNG}
\end{figure}
\end{column}
\begin{column}{0.6\linewidth}
\begin{itemize}
	\item RISC-Vå…±32ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œæœ‰é›¶å¯„å­˜å™¨ï¼Œä¸”PCä¸æ˜¯é€šç”¨å¯„å­˜å™¨
	\item x86-32ä»…8ä¸ªå¯„å­˜å™¨ï¼Œä¸”æ— é›¶å¯„å­˜å™¨
	\item arm-32æœ‰16ä¸ªå¯„å­˜å™¨ï¼Œä½†PCä¸ä½œä¸ºå•ç‹¬å¯„å­˜å™¨
\end{itemize}
\end{column}
\end{columns}
\end{frame}
% ä¼ªæŒ‡ä»¤ jump return beqz

\begin{frame}{Instruction Formats}
\only<1>{
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/rvi_formats.PNG}
\end{figure}
}
\only<2>{
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/rvi_formats_complex.PNG}
\end{figure}
}
\begin{itemize}
	\item rs1, rs2, rd are at the same position (MIPS is not)
	\item Immediates are put leftmost, sign 31 (sign-extension can be done before ID)
	\item 12bits regular + 20bits load upper
	\item Only has sign-extended imm
	\item The last bit used for extension (64-bit)
\end{itemize}
\end{frame}

\section{å•å‘¨æœŸCPU}
\begin{frame}
\sectionpage
\end{frame}

\subsection{Introduction}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}{Central Processor Unit (CPU)}
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/Lecture2/Abstraction-Processor.pdf}
\end{figure}
\end{frame}

\begin{frame}{CPUæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹}
2-phases:
\begin{enumerate}
	\item Fetch phase
	\item Execute phase
\end{enumerate}
5-stages CPU:
\begin{enumerate}
	\item Instruction Fetch (IF)
	\item Instruction Decode (ID)
	\item Execution (EXE)
	\item Access memory (MEM)
	\item Write back (WB)
\end{enumerate}
\end{frame}

\begin{frame}[fragile]{æ ¸å¿ƒæŒ‡ä»¤}
\begin{columns}
\begin{column}{0.5\linewidth}
Main instructions:
\begin{enumerate}
	\item \verb'add rd, rs1, rs2'
	\item \verb'addi rd, rs, imm'
	\item \verb'lw rd, rs(imm)'
	\item \verb'sw rs, rd(imm)'
	\item \verb'beq rd, rs, offset'
	\item \verb'j address'
\end{enumerate}
\end{column}
\begin{column}{0.5\linewidth}
Examples:
\begin{itemize}
	\item \verb'add $3, $2, $1'
	\item \verb'add $3, $2, 10'
	\item \verb'lw $3, $2(4)'
	\item \verb'sw $3, $2(4)'
	\item \verb'beq $3, $2, -2'
	\item \verb'j 0x00000050'
\end{itemize}
\end{column}
\end{columns}
\end{frame}

\subsection{Some Basic Modules}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}
\begin{center}
All problems in computer science can be solved by another\\
\quad\\
{\textbf{\huge{abstraction}}} layer.\\
\quad\\
éšè—low-levelç»†èŠ‚ï¼Œç»™high-levelæä¾›ç®€å•æ¨¡å‹
\end{center}
\end{frame}

\begin{frame}{å¸ƒå°”é€»è¾‘å±‚}
0-1: å¸ƒå°”è¿ç®—èƒ½å¤Ÿç”¨ç‰©ç†å™¨ä»¶æ¨¡æ‹Ÿï¼ˆå¦‚ç»§ç”µå™¨ã€äºŒæç®¡ç­‰ç­‰ï¼‰
\pause
\begin{center}
ç‰©ç†ç”µè·¯å±‚$\to$å¸ƒå°”é€»è¾‘å±‚
\end{center}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚}
1-2: åŸºæœ¬æ•°å­¦è¿ç®—èƒ½å¤Ÿç”¨å¸ƒå°”è¿ç®—æ¨¡æ‹Ÿ
\only<1-2>{
\begin{columns}
\begin{column}{0.4\linewidth}
\begin{center}
\begin{tabular}{|c|c|c|c|}\hline
A & B & A+B & Carry\\\hline
0 & 0 & 0 & 0\\\hline
0 & 1 & 1 & 0\\\hline
1 & 0 & 1 & 0\\\hline
1 & 1 & 0 & 1\\\hline
\end{tabular}
\end{center}
\pause
\[\begin{aligned}
A+B &= A\oplus B\\
Carry &= AB
\end{aligned}\]
\end{column}
\begin{column}{0.6\linewidth}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Abstraction-HA.pdf}
\end{figure}
\end{column}
\end{columns}
}
\only<3>{
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/Lecture2/Abstraction-FA.pdf}
\end{figure}
}
\only<4-5>{
\begin{figure}
\centering
\includegraphics[width=0.4\linewidth]{fig/Lecture2/Abstraction-nFA.pdf}
\end{figure}
}
\pause
\begin{center}
ç‰©ç†ç”µè·¯å±‚$\to$å¸ƒå°”é€»è¾‘å±‚$\to$è®¡ç®—å™¨ä»¶\textbf{ï¼ˆç»„åˆé€»è¾‘ï¼‰}
\end{center}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚ï¼ˆæ—¶åºé€»è¾‘ï¼‰}
\begin{columns}
\begin{column}{0.5\linewidth}
\begin{figure}
\centering
\begin{tabular}{c}
\includegraphics[width=\linewidth]{fig/Lecture2/ff_1.jpg}\\
\includegraphics[width=\linewidth]{fig/Lecture2/ff_2.jpg}
\end{tabular}
\end{figure}
\end{column}
\pause
\begin{column}{0.5\linewidth}
\begin{figure}
\centering
\begin{tabular}{c}
\includegraphics[width=\linewidth]{fig/Lecture2/ff_3.jpg}\\
\includegraphics[width=\linewidth]{fig/Lecture2/ff_4.jpg}
\end{tabular}
\end{figure}
\end{column}
\end{columns}
\pause
\begin{center}
\Large\textbf{é”å­˜å™¨(Latch)ï¼è®°å¿†ä¿¡æ¯ï¼}
\end{center}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚ï¼ˆæ—¶åºé€»è¾‘ï¼‰}
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/Lecture2/sr-latch.jpg}
\end{figure}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚ï¼ˆæ—¶åºé€»è¾‘ï¼‰}
\begin{center}
\large D Latch
\end{center}
\begin{figure}
\centering
\includegraphics[width=0.9\linewidth]{fig/Lecture2/d-latch.png}
\end{figure}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚ï¼ˆæ—¶åºé€»è¾‘ï¼‰}
\begin{center}
\large D Flip-flop (è§¦å‘å™¨) -- å¯¹\textbf{æ—¶é’Ÿè¾¹æ²¿}æ•æ„Ÿ
\end{center}
\begin{figure}
\centering
\begin{tabular}{cc}
\includegraphics[width=0.6\linewidth]{fig/Lecture2/d-ff.png}&
\includegraphics[width=0.3\linewidth]{fig/Lecture2/d-ff_2.jpg}
\end{tabular}
\end{figure}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚ï¼ˆæ—¶åºé€»è¾‘ï¼‰}
\begin{figure}
\centering
\begin{tabular}{c}
\includegraphics[width=0.8\linewidth]{fig/Lecture2/8bit-latch.jpg}\\
\includegraphics[width=0.6\linewidth]{fig/Lecture2/8bit-latch_2.jpg}
\end{tabular}
\end{figure}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚}
8-1 Multiplexer
\begin{figure}
\centering
\includegraphics[width=0.6\linewidth]{fig/Lecture2/8-1mux.jpg}
\end{figure}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚}
3-8 Decoder
\begin{figure}
\centering
\includegraphics[width=0.5\linewidth]{fig/Lecture2/3-8decoder.jpg}
\end{figure}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚}
8-bit Memory (RAM)
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/Lecture2/8bit-latch.jpg}
\end{figure}
\end{frame}

\begin{frame}{è®¡ç®—å™¨ä»¶å±‚}
å¯„å­˜å™¨å † (Register File)
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/Lecture2/register_files.PNG}
\end{figure}
\end{frame}

\begin{frame}
0-2: ä»ç†è®ºåˆ°å®è·µçš„ç¬¬ä¸€æ­¥
\begin{center}
ç‰©ç†ç”µè·¯å±‚$\to$å¸ƒå°”é€»è¾‘å±‚$\to$è®¡ç®—å™¨ä»¶/æ¨¡å—
\end{center}
\pause
2-3: ç”¨åŸºæœ¬å™¨ä»¶å®ç°é€šç”¨å¤„ç†å™¨(CPU)
\begin{center}
\Large\textbf{æ¶æ„å±‚}
\end{center}
\end{frame}

\subsection{Common Datapath}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}[fragile]{å…±åŒé€šè·¯(PC)}
Program Counter (PC)
\begin{columns}
\begin{column}{0.5\linewidth}
\begin{figure}
\centering
\includegraphics[width=0.5\linewidth]{fig/Lecture2/Datapath-PC.pdf}
\end{figure}
\end{column}
\begin{column}{0.5\linewidth}
æŒ‰å­—ç¼–å€\\
\verb'0x00000000'\\
\verb'0x00000004'\\
\verb'0x00000008'\\
\verb'0x0000000C'\\
$\cdots$
\end{column}
\end{columns}
\end{frame}

\subsection{R-R Instructions}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}[fragile]{Register-Register Instructions}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/r-r.PNG}
\end{figure}
\begin{itemize}
	\item \verb'add rd, rs1, rs2'
	\item \verb'and rd, rs1, rs2'
	\item \verb'sll rd, rs1, rs2'
	\item \verb'sub rd, rs1, rs2'
\end{itemize}
\end{frame}
% xor x1,x1,x2
% xor x2,x1,x2
% xor x1,x1,x2

\begin{frame}{Register-Register Instructions}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Datapath-R-R.pdf}
\end{figure}
\end{frame}

\begin{frame}{Arithmetic Logic Unit (ALU)}
\begin{center}
\begin{tabular}{|c|l|}
    \hline
    OpSel[2:0] & \multicolumn{1}{c|}{Function}\\
    \hline
    000   & $Y=A+B$\\
    \hline
    001   & $Y=A-B$\\
    \hline
    010   & $Y=B<<A$ \\
    \hline
    011   & $Y=A\mid B$\\
    \hline
    100   & $Y=A\& B$\\
    \hline
    101   & $Y=(A<B)\;?\;1\;:\;0$\\
    \hline
    110   & \multicolumn{1}{p{7cm}|}{$\begin{aligned}
    Y&=(((A<B) \&\& (A[31] == B[31] ))\\
    &||\quad( ( A[31] ==1 \&\& B[31] == 0)))\\
    &?\;1\;:\;0
    \end{aligned}$}\\
    \hline
    111   & $Y=A\oplus B$\\
    \hline
\end{tabular}
\end{center}
\end{frame}

\begin{frame}[fragile]{Register-Register Instructions}
NO OPERATION (NOP)\\
\verb'nop' $\to$ \verb'addi x0, x0, 0'\\
doesn't change any user-visible state, except for advancing PC
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/nop.PNG}
\end{figure}
\end{frame}

\subsection{R-I Instructions}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}[fragile]{Register-Immediate Instructions}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/r-i.PNG}
\end{figure}
All \textbf{sign-extended}
\begin{itemize}
	\item \verb'addi rd, rs1, imm' $\to$ imm=0, \verb'mv rd, rs1'
	\item \verb'sltiu rd, rs1, imm' $\to$ imm=1, \verb'seqz rd, rs'
	\item \verb'xori rd, rs1, imm' $\to$ imm=-1, \verb'not rd, rs'
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Register-Immediate Instructions}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Datapath-R-I.pdf}
\end{figure}
\end{frame}

\begin{frame}[fragile]{Register-Immediate Instructions}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/r-i_2.PNG}
\end{figure}
\begin{itemize}
	\item Shift left (logic): \verb'slli rd, rs1, imm'
	\item Shift right (logic): \verb'srli rd, rs1, imm'
	\item Shift right (arithmetic): \verb'srai rd, rs1, imm'
	\item Need not \verb'slai'
\end{itemize}
\end{frame}
% slli rd, rs1, shamt x[rd] = x[rs1] â‰ª shamt
% ç«‹å³æ•°é€»è¾‘å·¦ç§»(Shift Left Logical Immediate). I-type, RV32I and RV64I.
% æŠŠå¯„å­˜å™¨x[rs1]å·¦ç§»shamtä½ï¼Œç©ºå‡ºçš„ä½ç½®å¡«å…¥0ï¼Œç»“æœå†™å…¥x[rd]ã€‚å¯¹äºRV32Iï¼Œä»…å½“shamt[5]=0æ—¶ï¼ŒæŒ‡ä»¤æ‰æ˜¯æœ‰æ•ˆçš„ã€‚
% srai rd, rs1, shamt x[rd] = (x[rs1] â‰«ğ‘  shamt)
% ç«‹å³æ•°ç®—æœ¯å³ç§»(Shift Right Arithmetic Immediate). I-type, RV32I and RV64I.
% æŠŠå¯„å­˜å™¨ x[rs1]å³ç§» shamt ä½ï¼Œç©ºä½ç”¨ x[rs1]çš„æœ€é«˜ä½å¡«å……ï¼Œç»“æœå†™å…¥ x[rd]ã€‚å¯¹äº RV32Iï¼Œä»…å½“ shamt[5]=0 æ—¶æŒ‡ä»¤æœ‰æ•ˆã€‚

\begin{frame}[fragile]{Register-Immediate Instructions}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Datapath-R-I_2.pdf}
\end{figure}
Problem unfixed: How to extend for \verb'srai'? Or set a threshold in ALU?
\end{frame}

\begin{frame}[fragile]{Immediates format}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/imm.PNG}
\end{figure}
shift uses I-immediate
\end{frame}

\subsection{Load and Store}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}[fragile]{ä¸¤ç§å­˜å‚¨æ–¹å¼}
\begin{itemize}
	\item å°ç«¯(Little-endian)å­˜å‚¨: \textbf{RISC-V}ã€x86ã€iOSã€Android
	\item å¤§ç«¯(Big-endian)å­˜å‚¨: MIPSã€JPEGã€Photoshop
\end{itemize}
\begin{center}
\verb'0x12345678'\qquad
\begin{tabular}{ccccc}
Address & 00 & 04 & 08 & 0C\\\hline
Little & 78 & 56 & 34 & 12\\\hline
Big & 12 & 34 & 56 & 78\\\hline
\end{tabular}
\end{center}
æ— è¾¹ç•Œå¯¹é½(misaligned)ï¼æä¾›ç»†ç²’åº¦è®¿é—®ï¼ˆåŠå­—èŠ‚ï¼‰
\begin{figure}
\centering
\includegraphics[width=0.4\linewidth]{fig/Lecture2/aligned.PNG}
\end{figure}
\end{frame}

\begin{frame}[fragile]{Load \& Store}
RISC-V is \textbf{Load-Store Architecture}, only \verb'lw' and \verb'sw' can access memory\\
Other arithmetic instructions can only operate on CPU registers
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/lw-sw.PNG}
\end{figure}
\begin{itemize}
	\item \verb'lw rd, base(imm)'
	\item \verb'sw rs, base(imm)'
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Load}
\verb'x[rd] = sgnext(M[x[rs1] + sgnext(offset)][31:0])'
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Datapath-lw.pdf}
\end{figure}
\end{frame}
% å­—åŠ è½½ (Load Word). I-type, RV32I and RV64I.
% ä»åœ°å€ x[rs1] + sign-extend(offset)è¯»å–å››ä¸ªå­—èŠ‚ï¼Œå†™å…¥ x[rd]ã€‚å¯¹äº RV64Iï¼Œç»“æœè¦è¿›è¡Œç¬¦å·ä½æ‰©å±•ã€‚

\begin{frame}[fragile]{Store}
\verb'M[x[rs1] + sgnext(offset)] = x[rs2][31:0]'
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Datapath-sw.pdf}
\end{figure}
\end{frame}
% å­˜å­—(Store Word). S-type, RV32I and RV64I.
% å°† x[rs2]çš„ä½ä½ 4 ä¸ªå­—èŠ‚å­˜å…¥å†…å­˜åœ°å€ x[rs1]+sign-extend(offset)ã€‚

\subsection{Branch}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}[fragile]{Branch}
\begin{itemize}
	\item Used in loop
	\item Important for pipelining (Branch prediction)
	\item address range $\pm 4$KiB
\end{itemize}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/branch.PNG}
\end{figure}
\begin{itemize}
	\item \verb'beq rs1, rs2, imm'
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Branch}
\fontsm \verb'if (rs1 == rs2) pc += sgnext(offset)'åç§»é‡å‡ä¸º2çš„å€æ•°ï¼Œä½†åœ°å€å¿…é¡»4çš„å€æ•°ï¼Œå¦åˆ™æŠ›å¼‚å¸¸
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Datapath-branch.pdf}
\end{figure}
Use ExtSel (maybe 3 bits) to control which type of imm
\end{frame}
% ç›¸ç­‰æ—¶åˆ†æ”¯ (Branch if Equal). B-type, RV32I and RV64I.
% è‹¥å¯„å­˜å™¨ x[rs1]å’Œå¯„å­˜å™¨ x[rs2]çš„å€¼ç›¸ç­‰ï¼ŒæŠŠ pc çš„å€¼è®¾ä¸ºå½“å‰å€¼åŠ ä¸Šç¬¦å·ä½æ‰©å±•çš„åç§» offsetã€‚

\subsection{Jump}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}{Function Call}
å †æ ˆã€ä¿æŠ¤ç°åœºã€æ¢å¤ç°åœº
\begin{figure}
\centering
\begin{tabular}{cc}
\includegraphics[width=0.5\linewidth]{fig/Lecture2/Abstraction-Function_Call.pdf}&
\includegraphics[width=0.5\linewidth]{fig/Lecture2/memoryLayoutC.jpg}
\end{tabular}
\end{figure}
\end{frame}

\begin{frame}[fragile]{Jump}
Address range $\pm 1$MiB
\begin{figure}
\centering
\begin{tabular}{c}
\includegraphics[width=\linewidth]{fig/Lecture2/jal.PNG}\\
\includegraphics[width=\linewidth]{fig/Lecture2/jalr.PNG}
\end{tabular}
\end{figure}
\begin{itemize}
	\item \verb'jal rd, offset'
	\item \verb'jalr rd, offset(rs1)'
\end{itemize}
Use \verb'lui' and \verb'auipc' to jump anywhere in a 32-bit pc-relative address range
\end{frame}

\begin{frame}[fragile]{Jal}
\fontsm\verb'x[rd] = pc+4; pc += sgnext(offset)'
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/Lecture2/Datapath-jal.pdf}
\end{figure}
\end{frame}
% è·³è½¬å¹¶é“¾æ¥ (Jump and Link). J-type, RV32I and RV64I.
% æŠŠä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€(pc+4)ï¼Œç„¶åæŠŠ pc è®¾ç½®ä¸ºå½“å‰å€¼åŠ ä¸Šç¬¦å·ä½æ‰©å±•çš„ offsetã€‚rd é»˜è®¤ä¸º x1ã€‚

\begin{frame}[fragile]{Jalr}
% \verb't=pc+4; pc=(x[rs1]+sext(offset))&~1; x[rd]=t'
\fontsm{\verb'x[rd]=pc+4; pc=(x[rs1]+sext(offset))&~1;' åç§»é‡åŒæ ·æ˜¯2çš„å€æ•°ï¼Œåœ°å€é4çš„å€æ•°æŠ›å¼‚å¸¸}
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/Lecture2/Datapath-jalr.pdf}
\end{figure}
Question again: Where to implement \verb'&~1'?
\end{frame}
% è·³è½¬å¹¶å¯„å­˜å™¨é“¾æ¥ (Jump and Link Register). I-type, RV32I and RV64I.
% æŠŠ pc è®¾ç½®ä¸º x[rs1] + sign-extend(offset)ï¼ŒæŠŠè®¡ç®—å‡ºçš„åœ°å€çš„æœ€ä½æœ‰æ•ˆä½è®¾ä¸º 0ï¼Œå¹¶å°†åŸ pc+4çš„å€¼å†™å…¥ f[rd]ã€‚ rd é»˜è®¤ä¸º x1ã€‚

\subsection{Single Cycle CPU Summary}
\begin{frame}
\subsectionpage
\end{frame}

\begin{frame}{Harvard Architecture (Aiken and Mark)}
Separate program and data memory
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Datapath-All.pdf}
\end{figure}
\end{frame}

\begin{frame}{Control Signals}
Hardwired control is pure combinational logic
\begin{figure}
\centering
\includegraphics[width=0.5\linewidth]{fig/Lecture2/Datapath-Control-signals.pdf}
\end{figure}
\end{frame}

\begin{frame}{Princeton Architecture (von Neumann)}
The same program and data memory
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Datapath-Princeton.pdf}
\end{figure}
\end{frame}

\begin{frame}{State Transition}
Two-state controller (A filp-flop can be used to remember)
\begin{figure}
\centering
\includegraphics[width=0.4\linewidth]{fig/Lecture2/Datapath-State.pdf}
\end{figure}
\end{frame}

\begin{frame}
\begin{center}
\large So, Princeton and Harvard, which one is better?
\end{center}
\end{frame}

\begin{frame}{Clock Rate vs CPI}
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/Lecture2/clock_1.PNG}
\end{figure}
\end{frame}

\begin{frame}{Clock Rate vs CPI}
\begin{figure}
\centering
\includegraphics[width=0.8\linewidth]{fig/Lecture2/clock_rate-vs-cpi.PNG}
\end{figure}
\end{frame}

\begin{frame}{Two Architectures Summary}
\begin{itemize}
	\item Princeton: The same program and data memory, simple, two cycles, first place
	\item Harvard: Different program and data memory, complex, one cycle, ignored until 1970s
\end{itemize}
\begin{figure}
\centering
\includegraphics[width=0.6\linewidth]{fig/Lecture2/Core-i7-cache.jpg}
\end{figure}
\end{frame}
% https://www.csee.umbc.edu/courses/undergraduate/CMSC391/summer04/burt/lectures/arch/architectures.html

\section{å¤šå‘¨æœŸCPUæ¦‚è¿°}
\begin{frame}
\sectionpage
\end{frame}

\begin{frame}{Multi-Cycle CPU Datapath}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/Datapath-Multi.pdf}
\end{figure}
\end{frame}

\begin{frame}{Multi-Cycle CPU State Transition}
\begin{figure}
\centering
\includegraphics[width=0.6\linewidth]{fig/Lecture2/Datapath-Multi-State.pdf}
\end{figure}
\end{frame}

\section{RISC-Vçš„å†…å­˜æ¨¡å‹}
\begin{frame}
\sectionpage
\end{frame}

% ISA definition for Load, Store, Memory Fence, synchronization instructions should
% â€“ Be precise
% â€“ Permit maximum flexibility in hardware implementation
% â€“ Permit efficient implementation of high-level parallel constructs

\begin{frame}{å†…å­˜æ¨¡å‹}
å†…å­˜æ¨¡å‹ï¼šç³»ç»Ÿä¸ç¨‹åºå‘˜ä¹‹é—´çš„è§„èŒƒï¼Œé™å®šäº†\textbf{å…±äº«å†…å­˜}çš„å¤šçº¿ç¨‹/å¤šæ ¸å¤„ç†å™¨çš„\textbf{è¯»å†™}é¡ºåº
\begin{center}
{\fontsm
\textcolor{red}{\begin{tabular}{c}ç¨‹åºå‘˜\\ï¼ˆå®æ–½ï¼‰\end{tabular}}
$\xrightarrow{}$
\begin{tabular}{c}
é«˜çº§è¯­è¨€\\ï¼ˆå¯ç§»æ¤è§„èŒƒï¼‰
\end{tabular}
$\xrightarrow{\text{\textcolor{red}{ç¼–è¯‘å™¨ï¼ˆå®æ–½ï¼‰}}}$
\begin{tabular}{c}æ±‡ç¼–è¯­è¨€/æŒ‡ä»¤é›†\\ï¼ˆä¸å¯ç§»æ¤è§„èŒƒï¼‰\end{tabular}
$\xrightarrow{}$
\textcolor{red}{\begin{tabular}{c}ç¡¬ä»¶\\ï¼ˆå®æ–½ï¼‰\end{tabular}}
}\end{center}
å†…å­˜æ¨¡å‹çš„å¼ºå¼±ï¼š
\begin{itemize}
	\item å¼ºï¼šç¨‹åºå‘˜ç¼–ç¨‹ç®€å•ï¼Œä½†é™åˆ¶äº†ç¼–è¯‘å™¨æŒ‡ä»¤é‡æ’/ç¡¬ä»¶æµæ°´
	\item å¼±ï¼šç¡¬ä»¶å®æ–½æ›´ç®€ä¾¿ã€çµæ´»ã€é«˜æ•ˆï¼Œä½†ç¼–ç¨‹éº»çƒ¦
\end{itemize}
\end{frame}

\begin{frame}{å†…å­˜æ¨¡å‹}
RISC-V Weak Memory Ordering (RVWMO)
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/misc-mem.PNG}
\end{figure}
\begin{center}
FENCE seperates pred and succ (A sync)
\end{center}
Predecessor (P), successor (S)\\
Device input (I), output (O), read (R), write (W)\\
\quad\\
Hardware implementation? Emmm...
\end{frame}

% è¡¥å……è¯´æ˜ï¼š å†…å­˜ä¸€è‡´æ€§æ¨¡å‹
% RISC-V å…·æœ‰å®½æ¾çš„å†…å­˜ä¸€è‡´æ€§æ¨¡å‹ï¼ˆrelaxed memory consistency modelï¼‰ï¼Œå› æ­¤å…¶ä»–çº¿ç¨‹çœ‹åˆ°çš„å†…å­˜è®¿é—®å¯ä»¥æ˜¯ä¹±åºçš„ã€‚å›¾ 6.2 ä¸­ï¼Œæ‰€æœ‰çš„ RV32A æŒ‡ä»¤éƒ½æœ‰ä¸€ä¸ªè¯·æ±‚ä½ï¼ˆaqï¼‰å’Œä¸€ä¸ªé‡Šæ”¾ä½ï¼ˆrlï¼‰ã€‚ aq è¢«ç½®ä½çš„åŸå­æŒ‡ä»¤ä¿è¯å…¶å®ƒçº¿ç¨‹åœ¨éšåçš„å†…å­˜è®¿é—®ä¸­çœ‹åˆ°é¡ºåºçš„ AMO æ“ä½œï¼› rl è¢«ç½®ä½çš„åŸå­æŒ‡ä»¤ä¿è¯å…¶å®ƒçº¿ç¨‹åœ¨æ­¤ä¹‹å‰çœ‹åˆ°é¡ºåºçš„åŸå­æ“ä½œã€‚æƒ³è¦äº†è§£æ›´è¯¦ç»†çš„æœ‰å…³çŸ¥è¯†ï¼Œå¯ä»¥æŸ¥çœ‹[Adve and Gharachorloo 1996]ã€‚

\section{RISC-Væ‰©å±•}
\begin{frame}
\sectionpage
\end{frame}

\begin{frame}{RV32Içš„æ‰©å±•}
\begin{itemize}
	\item RV32M: ä¹˜é™¤æ³•
	\item RV32F/RV32D: å•åŒç²¾åº¦æµ®ç‚¹æ•°
	\item RV32A: åŸå­æŒ‡ä»¤
	\item RV32C: å‹ç¼©æŒ‡ä»¤(16ä½)
	\item RV32V: å‘é‡æ¶æ„ï¼ˆé¿å…SIMDï¼‰
% å‘é‡è®¡ç®—æœºä»å†…å­˜ä¸­ä¸­æ”¶é›†æ•°æ®å¹¶å°†å®ƒä»¬æ”¾å…¥é•¿çš„ï¼Œ é¡ºåºçš„å‘é‡å¯„å­˜å™¨ä¸­ã€‚ åœ¨è¿™äº›å‘é‡å¯„å­˜å™¨ä¸Šï¼Œ æµæ°´çº¿æ‰§è¡Œå•å…ƒå¯ä»¥é«˜æ•ˆåœ°æ‰§è¡Œè¿ç®—ã€‚ç„¶åï¼Œå‘é‡æ¶æ„å°†ç»“æœä»å‘é‡å¯„å­˜å™¨ä¸­å–å‡ºï¼Œå¹¶å°†å…¶å¹¶åˆ†æ•£åœ°å­˜å›ä¸»å­˜ã€‚å‘é‡å¯„å­˜å™¨çš„å¤§å°ç”±å®ç°å†³å®šï¼Œè€Œä¸æ˜¯åƒ SIMD ä¸­é‚£æ ·åµŒå…¥æ“ä½œç ä¸­ã€‚æˆ‘ä»¬å°†ä¼šçœ‹åˆ°ï¼Œ å°†å‘é‡çš„é•¿åº¦å’Œæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸå¯ä»¥è¿›è¡Œçš„æœ€å¤§æ“ä½œæ•°åˆ†ç¦»ï¼Œæ˜¯å‘é‡ä½“ç³»ç»“æ„çš„å…³é”®æ‰€åœ¨ï¼šå‘é‡å¾®æ¶æ„å¯ä»¥çµæ´»åœ°è®¾è®¡æ•°æ®å¹¶è¡Œç¡¬ä»¶è€Œä¸ä¼šå½±å“åˆ°ç¨‹åºå‘˜ï¼Œç¨‹åºå‘˜å¯ä»¥ä¸ç”¨é‡å†™ä»£ç å°±äº«å—åˆ°é•¿å‘é‡å¸¦æ¥çš„å¥½å¤„ã€‚æ­¤å¤–ï¼Œå‘é‡æ¶æ„æ¯” SIMDæ¶æ„æ‹¥æœ‰æ›´å°‘çš„æŒ‡ä»¤æ•°é‡ã€‚è€Œä¸”ï¼Œä¸ SIMD ä¸åŒï¼Œå‘é‡æ¶æ„æœ‰ç€å®Œå–„çš„ç¼–è¯‘å™¨æŠ€æœ¯ã€‚
	\item RV64: 64ä½
\end{itemize}
ä»¥åŠä¸€äº›æœªæ¥å¯é€‰æ‰©å±•
\end{frame}

\begin{frame}{Opcode Map}
\begin{figure}
\centering
\includegraphics[width=\linewidth]{fig/Lecture2/opcode_map.PNG}
\end{figure}
\end{frame}

\begin{frame}
\begin{figure}
\centering
\includegraphics[width=0.5\linewidth]{fig/Lecture2/base32.PNG}
\end{figure}
\end{frame}

\end{document}